#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail
set -o errtrace
(shopt -p inherit_errexit &>/dev/null) && shopt -s inherit_errexit

if (( $# == 0 )); then
  cat <<EOF
Usage: $SUB_NAME enable <type> <name>...

Description: Enable matched <name> of <type>
EOF
  exit 0
fi

readonly ENABLED_DIR=$DOTFILES_DIR/enabled

# shellcheck source=../../runtime/bash_config.bash
. "$DOTFILES_DIR/runtime/bash_config.bash"
# shellcheck source=./plugable.bash
. "$DOTFILES_DIR/bin/sub/plugable.bash"

# Provide sub completions
if [[ "${1:-}" == "--complete" ]]; then
  if (( $# < 3 )); then
    echo "${!t_map[@]}"
  else
    readonly t=$2
    readonly ts=${t_map[$t]}
    declare -a plugin_dirs=()
    get_plugin_dirs plugin_dirs

    for dir in "${plugin_dirs[@]}" ; do
      find "$dir" -maxdepth 1 -type f -name "*.bash" -exec basename {} ".bash" \;
    done
  fi
  exit 0
fi

readonly t=$1
readonly ts=${t_map[$t]}
shift 1
enable_it "$@"
