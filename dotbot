#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail
set -o errtrace
(shopt -p inherit_errexit &>/dev/null) && shopt -s inherit_errexit

readonly BASEDIR="$(cd -P -- "$(dirname -- "$0")" && pwd -P)"

# shellcheck source=bash/xdg.bash
. "${BASEDIR}/bash/xdg.bash"

# shellcheck source=./deps/lobash.bash
. "${BASEDIR}/deps/lobash.bash"

if (( $# > 0 )); then
  DOTBOT_CONF=$1
else
  case "$(l.detect_os)" in
    MacOS) DOTBOT_CONF=${BASEDIR}/dotbot.conf/macos.yaml ;;
    Linux) DOTBOT_CONF=${BASEDIR}/dotbot.conf/debian.yaml ;;
  esac
fi

echo "DOTBOT_CONF=${DOTBOT_CONF}"

"${BASEDIR}/deps/dotbot/bin/dotbot" -d "${BASEDIR}" -c "$DOTBOT_CONF"
